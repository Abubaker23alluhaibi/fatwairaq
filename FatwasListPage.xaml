<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:MyMauiApp.Models"
             x:Class="MyMauiApp.FatwasListPage"
             BackgroundColor="#F5F6F2"
             Title="الفتاوى">
    <ContentPage.ToolbarItems>
        <ToolbarItem Text="رجوع" Clicked="OnBackClicked" Order="Primary" />
    </ContentPage.ToolbarItems>

    <RefreshView x:Name="RefreshView"
                 IsRefreshing="False"
                 Refreshing="OnRefresh"
                 RefreshColor="#D4AF37">
        <Grid RowDefinitions="Auto,*">

            <Border Grid.Row="0"
                    StrokeShape="RoundRectangle 0,0,25,25"
                    StrokeThickness="0"
                    BackgroundColor="#0D4435"
                    Padding="20">
                <Border.Shadow>
                    <Shadow Brush="#0D4435" Offset="0,4" Radius="10" Opacity="0.3"/>
                </Border.Shadow>
                
                <Label x:Name="HeaderLabel"
                       Text="قائمة الفتاوى" 
                       TextColor="#D4AF37" 
                       FontSize="22" 
                       FontAttributes="Bold" 
                       HorizontalOptions="Center"/>
            </Border>

            <VerticalStackLayout Grid.Row="1" 
                                 x:Name="LoadingIndicator"
                                 VerticalOptions="Center" 
                                 HorizontalOptions="Center"
                                 Spacing="10">
                <ActivityIndicator IsRunning="True" Color="#0D4435" Scale="1.5"/>
                <Label Text="جاري التحميل..." TextColor="#0D4435" FontSize="14"/>
            </VerticalStackLayout>

            <CollectionView x:Name="FatwasCollectionView"
                            Grid.Row="1"
                            IsVisible="False"
                            SelectionMode="Single"
                            SelectionChanged="OnFatwaSelected"
                            VerticalScrollBarVisibility="Never"
                            Margin="0,10">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Fatwa">
                        <Border StrokeShape="RoundRectangle 15" 
                                BackgroundColor="White" 
                                Padding="20" 
                                Margin="15,8"
                                StrokeThickness="0.5"
                                Stroke="#E0E0E0">
                            <Border.Shadow>
                                <Shadow Brush="Black" Offset="0,2" Radius="5" Opacity="0.05"/>
                            </Border.Shadow>
                            
                            <VerticalStackLayout Spacing="12">
                                <Label Text="{Binding Title}" 
                                       FontSize="18" 
                                       FontAttributes="Bold" 
                                       TextColor="#0D4435"
                                       LineBreakMode="WordWrap"/>
                                
                                <Label Text="{Binding Question}" 
                                       FontSize="14" 
                                       TextColor="#555"
                                       MaxLines="2"
                                       LineBreakMode="TailTruncation"
                                       LineHeight="1.2"/>

                                <BoxView HeightRequest="1" Color="#F0F0F0" Margin="0,5"/>
                                
                                <Grid ColumnDefinitions="*,*">
                                    <VerticalStackLayout Grid.Column="0" Spacing="2">
                                        <Label Text="الباب الفقهي" FontSize="10" TextColor="#999"/>
                                        <Label Text="{Binding CategoryName}" 
                                               FontSize="12" 
                                               TextColor="#757575"/>
                                    </VerticalStackLayout>
                                    
                                    <VerticalStackLayout Grid.Column="1" HorizontalOptions="End" Spacing="2">
                                        <Label Text="المفتي" FontSize="10" TextColor="#999" HorizontalOptions="End"/>
                                        <Label Text="{Binding ScholarName}" 
                                               FontSize="12" 
                                               TextColor="#D4AF37"
                                               FontAttributes="Bold"
                                               HorizontalOptions="End"/>
                                    </VerticalStackLayout>
                                </Grid>
                                
                                <Label x:Name="DateLabel"
                                       Text="{Binding Date, StringFormat='{0:yyyy-MM-dd}'}" 
                                       FontSize="11" 
                                       TextColor="#BDBDBD"
                                       HorizontalOptions="End"/>
                            </VerticalStackLayout>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <VerticalStackLayout x:Name="NoResultsLabel"
                                 Grid.Row="1"
                                 IsVisible="False"
                                 VerticalOptions="Center"
                                 HorizontalOptions="Center"
                                 Spacing="10">
                <Label x:Name="NoResultsText"
                       Text="غير متوفر أو هناك خطأ"
                       FontSize="16"
                       TextColor="#666"
                       HorizontalOptions="Center"/>
            </VerticalStackLayout>
        </Grid>
    </RefreshView>
</ContentPage>
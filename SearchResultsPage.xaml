<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:MyMauiApp"
             xmlns:models="clr-namespace:MyMauiApp.Models"
             x:Class="MyMauiApp.SearchResultsPage"
             Title="نتائج البحث">
    <ContentPage.ToolbarItems>
        <ToolbarItem Text="رجوع" Clicked="OnBackClicked" Order="Primary" />
    </ContentPage.ToolbarItems>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Frame Grid.Row="0"
               BackgroundColor="#0D4435" 
               CornerRadius="0" 
               Padding="15"
               Margin="0,0,0,10">
            <Label x:Name="SearchKeywordLabel"
                   Text="نتائج البحث" 
                   TextColor="White" 
                   FontSize="18" 
                   FontAttributes="Bold" 
                   HorizontalOptions="Center"/>
        </Frame>

        <!-- Loading Indicator -->
        <ActivityIndicator x:Name="LoadingIndicator"
                          Grid.Row="1"
                          IsRunning="True"
                          IsVisible="True"
                          Color="#0D4435"
                          VerticalOptions="Center"
                          HorizontalOptions="Center"/>

        <!-- Results List (نفس شكل وقابلية ضغط قائمة الفتاوى) -->
        <RefreshView x:Name="ResultsRefreshView"
                    Grid.Row="1"
                    IsRefreshing="False"
                    Refreshing="OnRefresh"
                    RefreshColor="#D4AF37">
            <CollectionView x:Name="ResultsCollectionView"
                            IsVisible="False"
                            SelectionMode="Single"
                            SelectionChanged="OnFatwaSelected"
                            VerticalScrollBarVisibility="Never"
                            Margin="0,10">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Fatwa">
                        <Border StrokeShape="RoundRectangle 15" 
                                BackgroundColor="White" 
                                Padding="20" 
                                Margin="15,8"
                                StrokeThickness="0.5"
                                Stroke="#E0E0E0">
                            <Border.Shadow>
                                <Shadow Brush="Black" Offset="0,2" Radius="5" Opacity="0.05"/>
                            </Border.Shadow>
                            <VerticalStackLayout Spacing="12">
                            <Label Text="{Binding Title}" 
                                   FontSize="18" 
                                   FontAttributes="Bold" 
                                   TextColor="#0D4435"
                                   LineBreakMode="WordWrap"/>
                            
                            <Label Text="{Binding Question}" 
                                   FontSize="14" 
                                   TextColor="#555"
                                   MaxLines="2"
                                   LineBreakMode="TailTruncation"
                                   LineHeight="1.2"/>

                            <BoxView HeightRequest="1" Color="#F0F0F0" Margin="0,5"/>
                            
                            <Grid ColumnDefinitions="*,*">
                                <VerticalStackLayout Grid.Column="0" Spacing="2">
                                    <Label Text="الباب الفقهي" FontSize="10" TextColor="#999"/>
                                    <Label Text="{Binding CategoryName}" 
                                           FontSize="12" 
                                           TextColor="#757575"/>
                                </VerticalStackLayout>
                                
                                <VerticalStackLayout Grid.Column="1" HorizontalOptions="End" Spacing="2">
                                    <Label Text="المفتي" FontSize="10" TextColor="#999" HorizontalOptions="End"/>
                                    <Label Text="{Binding ScholarName}" 
                                           FontSize="12" 
                                           TextColor="#D4AF37"
                                           FontAttributes="Bold"
                                           HorizontalOptions="End"/>
                                </VerticalStackLayout>
                            </Grid>
                            
                            <Label Text="{Binding Date, StringFormat='{0:yyyy-MM-dd}'}" 
                                   FontSize="11" 
                                   TextColor="#BDBDBD"
                                   HorizontalOptions="End"/>
                            </VerticalStackLayout>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>

        <!-- No Results Message -->
        <Label x:Name="NoResultsLabel"
               Grid.Row="1"
               Text="لا توجد نتائج"
               FontSize="18"
               TextColor="#999"
               IsVisible="False"
               VerticalOptions="Center"
               HorizontalOptions="Center"/>

    </Grid>

</ContentPage>

